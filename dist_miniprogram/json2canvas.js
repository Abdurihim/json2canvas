!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cax")):"function"==typeof define&&define.amd?define(["cax"],t):"object"==typeof exports?exports.json2canvas=t(require("cax")):e.json2canvas=t(e.cax)}(window,function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(t,n){t.exports=e},function(e,t,n){"use strict";n.r(t),n.d(t,"draw",function(){return u});var r=n(0),i=n.n(r);const o="undefined"!=typeof wx&&!wx.createCanvas,l={rect:"rect",circle:"circle",image:"image",text:"text",group:"group"};let a=null,c=new Map;function u(e,t,n=null,r){const u=[(e=Object.assign({scale:1},e)).width*e.scale,e.height*e.scale,t];(a=o?new i.a.Stage(...u,n):new i.a.Stage(...u)).scale=e.scale;let d=function e(t){let n=[];let r=[];t.children.forEach(t=>{t.type===l.image?-1===r.indexOf(t.url)&&(r.push(t.url),n.push(function(e){return new Promise((t,n)=>{if(o)wx.getImageInfo({src:e,success(n){new i.a.Bitmap(n.path.startsWith("http")?n.path:e,function(){t({url:e,bitmap:this})})},fail(n){console.error(n),t({url:e,bitmap:null})}});else{const n=new Image;n.onload=function(){new i.a.Bitmap(e,function(){t({url:e,bitmap:this})})},n.onerror=function(n){console.error(n),t({url:e,bitmap:null})},n.src=e}})}(t.url))):t.type===l.group&&n.push(...e(t))});return n}(e);Promise.all(d).then(t=>{t.forEach(({url:e,bitmap:t})=>{c.set(e,t)}),function e({option:t,parent:n}){const r=new i.a.Group;t.width&&(r.width=t.width);t.height&&(r.height=t.height);s(r,t,n);t.children.forEach(t=>{let n=null,o={option:t,parent:r};switch(t.type){case l.group:e(o);break;case l.rect:case l.circle:n=function({option:e,parent:t}){e=Object.assign({lineWidth:1,lt:!0,rt:!0,lb:!0,rb:!0},e);const n=new i.a.Graphics;switch(n.beginPath(),e.type){case l.rect:e.r>0?function({ele:e,option:t}){const n=t.r,r=t.r,i=t.width,o=t.width,l=t.height,a=t.height;e.moveTo(r,0),t.rt?e.arcTo(i,0,o,l,n):e.lineTo(i,0);t.rb?e.arcTo(o,l,0,a,n):e.lineTo(o,l);t.lb?e.arcTo(0,a,0,0,n):e.lineTo(0,a);t.lt?e.arcTo(0,0,r,0,n):e.lineTo(0,0)}({ele:n,option:e}):n.rect(0,0,e.width,e.height);break;case l.circle:n.arc(0,0,e.r,0,2*Math.PI,!1)}n.closePath();let r=p({option:e});!r||e.fillStyle||e.strokeStyle||(e.fillStyle="#FFFFFF");e.fillStyle?(n.fillStyle(r||e.fillStyle),n.fill()):e.strokeStyle&&(n.lineWidth(e.lineWidth),n.strokeStyle(r||e.strokeStyle),n.stroke());return s(n,e,t),n}(o);break;case l.image:n=function({option:e,parent:t}){let n=c.get(e.url);if(n){n.used?n=n.clone():n.used=!0;let r=n.width;if(n.scale=e.width/r,s(n,e,t),e.isCircular){const e=new i.a.Graphics;e.arc(r/2,r/2,r/2,0,2*Math.PI),n.clip(e)}return n}return null}(o);break;case l.text:n=function({option:e,parent:t}){let n=f(e);const r=/\b(?![\u0020-\u002F\u003A-\u003F\u2000-\u206F\u2E00-\u2E7F\u3000-\u303F\uFF00-\uFF1F])|(?=[\u2E80-\u2FFF\u3040-\u9FFF])/g;if(e.maxWidth&&n.getWidth()>e.maxWidth){let i="",o=e.y,l=1,a=[];e.text.replace(r,function(){a.push(arguments[arguments.length-2]-1)});let c=0;for(let r=0;r<e.text.length;r++)if(-1!==a.indexOf(r)&&(c=r),i+=[e.text[r]],n.text=i,n.getWidth()>e.maxWidth){let n=f(e);if(l===e.maxLine&&r!==e.text.length?(n.text=i.substring(0,i.length-1)+"...",i=""):c===r?(n.text=i,i=""):(n.text=i.substring(0,i.length-(r-c)),i=i.substring(i.length-(r-c),i.length)),h({ele:n,option:e,value:"x",parent:t}),n.y=o,t.add(n),l===e.maxLine&&r!==e.text.length)break;o+=e.lineHeight||0,l++}if(!i)return;n.text=i,h({ele:n,option:e,value:"x",parent:t}),n.y=o}else s(n,e,t);return n}(o)}n&&r.add(n)});a.add(r)}({option:e}),a.children.reverse(),setTimeout(()=>{a.update(),r&&r()},0)})}function s(e,t,n){h({ele:e,option:t,value:"x",parent:n}),h({ele:e,option:t,value:"y",parent:n})}function h({ele:e,option:t,value:n,parent:r}){switch(t[n]){case"center":switch(t.type){case l.image:e[n]=(r.width-e.width*e.scale)/2;break;case l.text:e[n]=(r.width-e.getWidth())/2}break;case"bottom":switch(t.type){case l.image:e[n]=(r?r.height:t.height/t.scale)-e.height*e.scale;break;case l.rect:case l.group:e[n]=(r?r.height:t.height/t.scale)-t.height}break;default:switch(t.type){case l.circle:e[n]=t[n]+t.r;break;default:e[n]=t[n]||0}}}function p({option:e}){let t=null;if(e.linearGradient&&e.colors){t=(o?a.ctx:a.canvas.getContext("2d")).createLinearGradient(...e.linearGradient);for(let n=0;n<e.colors.length;n++)t.addColorStop(...e.colors[n])}return t}function f(e){const t=new i.a.Text(e.text,e);let n=p({option:e});return n&&(t.color=n),e.shadow&&(t.shadow=e.shadow),t}}])});