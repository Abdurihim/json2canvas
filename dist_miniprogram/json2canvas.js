(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e(require("cax")):"function"===typeof define&&define.amd?define(["cax"],e):"object"===typeof exports?exports["json2canvas"]=e(require("cax")):t["json2canvas"]=e(t["cax"])})(window,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(e,n){e.exports=t},function(t,e,n){var i,r;i=n(2),r=n(3),t.exports=function(){"use strict";var t;function e(t){return function(){return t}}function n(t){t=t||{},this.config=t,this.config.childrenPropertyName=t.childrenPropertyName||"children",this.config.modelComparatorFn=t.modelComparatorFn}function o(t,e){return e.parent=t,t.children.push(e),e}function a(t,e){this.config=t,this.model=e,this.children=[]}function l(t){return"function"===typeof t.config.modelComparatorFn}function s(t,e,n){var i;if(!(e instanceof a))throw new TypeError("Child must be of type Node.");if(e.parent=t,t.model[t.config.childrenPropertyName]instanceof Array||(t.model[t.config.childrenPropertyName]=[]),l(t))i=r(t.config.modelComparatorFn,t.model[t.config.childrenPropertyName],e.model),t.model[t.config.childrenPropertyName].splice(i,0,e.model),t.children.splice(i,0,e);else if(void 0===n)t.model[t.config.childrenPropertyName].push(e.model),t.children.push(e);else{if(n<0||n>t.children.length)throw new Error("Invalid index.");t.model[t.config.childrenPropertyName].splice(n,0,e.model),t.children.splice(n,0,e)}return e}function h(){var e={};if(1===arguments.length?"function"===typeof arguments[0]?e.fn=arguments[0]:e.options=arguments[0]:2===arguments.length?"function"===typeof arguments[0]?(e.fn=arguments[0],e.ctx=arguments[1]):(e.options=arguments[0],e.fn=arguments[1]):(e.options=arguments[0],e.fn=arguments[1],e.ctx=arguments[2]),e.options=e.options||{},e.options.strategy||(e.options.strategy="pre"),!t[e.options.strategy])throw new Error("Unknown tree walk strategy. Valid strategies are 'pre' [default], 'post' and 'breadth'.");return e}return t={},n.prototype.parse=function(t){var e,n,r;if(!(t instanceof Object))throw new TypeError("Model must be of type object.");if(r=new a(this.config,t),t[this.config.childrenPropertyName]instanceof Array)for(this.config.modelComparatorFn&&(t[this.config.childrenPropertyName]=i(this.config.modelComparatorFn,t[this.config.childrenPropertyName])),e=0,n=t[this.config.childrenPropertyName].length;e<n;e++)o(r,this.parse(t[this.config.childrenPropertyName][e]));return r},a.prototype.isRoot=function(){return void 0===this.parent},a.prototype.hasChildren=function(){return this.children.length>0},a.prototype.addChild=function(t){return s(this,t)},a.prototype.addChildAtIndex=function(t,e){if(l(this))throw new Error("Cannot add child at index when using a comparator function.");return s(this,t,e)},a.prototype.setIndex=function(t){if(l(this))throw new Error("Cannot set node index when using a comparator function.");if(this.isRoot()){if(0===t)return this;throw new Error("Invalid index.")}if(t<0||t>=this.parent.children.length)throw new Error("Invalid index.");var e=this.parent.children.indexOf(this);return this.parent.children.splice(t,0,this.parent.children.splice(e,1)[0]),this.parent.model[this.parent.config.childrenPropertyName].splice(t,0,this.parent.model[this.parent.config.childrenPropertyName].splice(e,1)[0]),this},a.prototype.getPath=function(){var t=[];return function e(n){t.unshift(n),n.isRoot()||e(n.parent)}(this),t},a.prototype.getIndex=function(){return this.isRoot()?0:this.parent.children.indexOf(this)},a.prototype.walk=function(){var e;e=h.apply(this,arguments),t[e.options.strategy].call(this,e.fn,e.ctx)},t.pre=function t(e,n){var i,r,o;for(o=e.call(n,this),i=0,r=this.children.length;i<r;i++){if(!1===o)return!1;o=t.call(this.children[i],e,n)}return o},t.post=function t(e,n){var i,r,o;for(i=0,r=this.children.length;i<r;i++)if(o=t.call(this.children[i],e,n),!1===o)return!1;return o=e.call(n,this),o},t.breadth=function(t,e){var n=[this];(function i(){var r,o,a;if(0!==n.length){for(a=n.shift(),r=0,o=a.children.length;r<o;r++)n.push(a.children[r]);!1!==t.call(e,a)&&i()}})()},a.prototype.all=function(){var n,i=[];return n=h.apply(this,arguments),n.fn=n.fn||e(!0),t[n.options.strategy].call(this,function(t){n.fn.call(n.ctx,t)&&i.push(t)},n.ctx),i},a.prototype.first=function(){var n,i;return n=h.apply(this,arguments),n.fn=n.fn||e(!0),t[n.options.strategy].call(this,function(t){if(n.fn.call(n.ctx,t))return i=t,!1},n.ctx),i},a.prototype.drop=function(){var t;return this.isRoot()||(t=this.parent.children.indexOf(this),this.parent.children.splice(t,1),this.parent.model[this.config.childrenPropertyName].splice(t,1),this.parent=void 0,delete this.parent),this},n}()},function(t,e){t.exports=function(){"use strict";function t(n,i){var r,o,a=i.length;return a>=2?(r=i.slice(0,a/2),o=i.slice(a/2,a),e(n,t(n,r),t(n,o))):i.slice()}function e(t,e,n){var i=[],r=e.length,o=n.length;while(r>0&&o>0)t(e[0],n[0])<=0?(i.push(e.shift()),r--):(i.push(n.shift()),o--);return r>0?i.push.apply(i,e):i.push.apply(i,n),i}return t}()},function(t,e){t.exports=function(){"use strict";function t(t,e,n){var i,r;for(i=0,r=e.length;i<r;i++)if(t(e[i],n)>0)break;return i}return t}()},function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i);function o({option:t}){let e=null;if(t.linearGradient&&t.colors){e=a().createLinearGradient(...t.linearGradient);for(let n=0;n<t.colors.length;n++)e.addColorStop(...t.colors[n])}return e}function a(){return s?wx.createCanvasContext("measure0"):"undefined"!==typeof document?document.createElement("canvas").getContext("2d"):null}function l(t){return JSON.parse(JSON.stringify(t))}const s="undefined"!==typeof wx&&!wx.createCanvas&&wx.createCanvasContext,h=("undefined"!==typeof wx&&wx.createCanvas,{rect:"rect",circle:"circle",image:"image",text:"text",group:"group"});let c;s?c=wx.createCanvasContext("measure0"):"undefined"!==typeof document&&(c=document.createElement("canvas").getContext("2d"));class u extends i["Graphics"]{constructor(t){if(super(),t=Object.assign({font:"10px sans-serif",color:"black",textAlign:"left",baseline:"top",orientation:"horizontal",lineHeight:0},t),!t.lineHeight){let e=/\d+px/i.exec(t.font);e&&(t.lineHeight=parseFloat(e[0]))}this.option=t||{},this.text=t.text}getWidth(t){c||util.isWegame&&(c=wx.createCanvas().getContext("2d")),this.option.font&&(c.font=this.option.font);let e=c.measureText(t||this.text).width;return e}getHeight(){return this.renderBreakLine({ctx:this,isMeasure:!0})}render(t){t.fillStyle=o({option:this.option})||this.option.color,t.font=this.option.font,t.textAlign=this.option.textAlign,t.textBaseline=this.option.baseline,"vertical"===this.option.orientation?this.renderVertical({ctx:t}):this.option.maxWidth&&this.getWidth()>this.option.maxWidth?this.renderBreakLine({ctx:t}):t.fillText(this.text,0,0)}renderVertical({ctx:t,isMeasure:e=!1}){var n=this.text.split(""),i=n.map(t=>{return this.getWidth(t)}),r=t.textAlign,o=t.textBaseline;let a=0,l=0,s=this.text;return"left"==r?a+=Math.max.apply(null,i)/2:"right"==r&&(a-=Math.max.apply(null,i)/2),"bottom"==o||"alphabetic"==o||"ideographic"==o?l-=i[0]/2:"top"!=o&&"hanging"!=o||(l+=i[0]/2),t.textAlign="center",t.textBaseline="middle",n.forEach(function(e,n){let r=e.charCodeAt(0);r<=256?(t.translate(a,l),t.rotate(90*Math.PI/180),t.translate(-a,-l)):n>0&&s.charCodeAt(n-1)<256&&(l+=i[n-1]/2),t.fillText(e,a,l),r<=256&&(t.translate(a,l),t.rotate(-90*Math.PI/180),t.translate(-a,-l));var o=i[n];l+=o}),t.textAlign=r,t.textBaseline=o,l}renderBreakLine({ctx:t,isMeasure:e=!1}){const n=/\b(?![\u0020-\u002F\u003A-\u003F\u2000-\u206F\u2E00-\u2E7F\u3000-\u303F\uFF00-\uFF1F])|(?=[\u2E80-\u2FFF\u3040-\u9FFF])/g;let i="",r=0,o=1,a=[];this.option.text.replace(n,function(){a.push(arguments[arguments.length-2]-1)});let l=0;for(let s=0;s<this.option.text.length;s++)if(-1!==a.indexOf(s)&&(l=s),i+=[this.option.text[s]],this.getWidth(i)>this.option.maxWidth||10===this.option.text[s].charCodeAt(0)){let n="";if(o===this.option.maxLine&&s!==this.option.text.length?(n=i.substring(0,i.length-1)+"...",i=""):l===s||10===this.option.text[s].charCodeAt(0)?(n=i,i=""):(n=i.substring(0,i.length-(s-l)),i=i.substring(i.length-(s-l),i.length)),10===this.option.text[s].charCodeAt(0)&&(n=n.substring(0,n.length-1)),!e&&t.fillText(n,0,r),o===this.option.maxLine&&s!==this.option.text.length)break;r+=this.option.lineHeight||0,o++}return i&&!e&&t.fillText(i,0,r),r+this.option.lineHeight}}var p=u;class d extends i["Graphics"]{constructor(t){switch(super(),t=Object.assign({lineWidth:1,lt:!0,rt:!0,lb:!0,rb:!0},t),this.beginPath(),t.type){case h.rect:t.r>0?this.setRoundedRect(t):this.rect(0,0,t.width,t.height);break;case h.circle:this.arc(0,0,t.r,0,2*Math.PI,!1);break}this.closePath();let e=o({option:t});t.fillStyle||t.strokeStyle||(t.fillStyle="#FFFFFF"),t.fillStyle?(this.fillStyle(e||t.fillStyle),this.fill()):t.strokeStyle&&(this.lineWidth(t.lineWidth),this.strokeStyle(e||t.strokeStyle),this.stroke())}setRoundedRect(t){const e=t.r,n=t.r,i=0,r=t.width,o=0,a=t.width,l=t.height,s=0,h=t.height,c=0,u=0;this.moveTo(n,i),t.rt?this.arcTo(r,o,a,l,e):this.lineTo(r,o),t.rb?this.arcTo(a,l,s,h,e):this.lineTo(a,l),t.lb?this.arcTo(s,h,c,u,e):this.lineTo(s,h),t.lt?this.arcTo(c,u,n,i,e):this.lineTo(c,u)}}var f=d,g=n(1),x=n.n(g);n.d(e,"draw",function(){return b});const m=new x.a;let y=null,w=new Map;function b(t,e,n=null,i){const o=m.parse(Object.assign({scale:1},l(t)));T(o);const a=[o.model.width*o.model.scale,o.model.height*o.model.scale,e];y=s?new r.a.Stage(...a,n):new r.a.Stage(...a),y.scale=o.model.scale;let c=[],u=[];o.all().forEach((t,e)=>{let n=t.model;if(n.url&&!c.includes(n.url)&&(c.push(n.url),u.push(E(n.url))),(n.type===h.group||0===e)&&n.width&&n.height)if(n.url){let e={type:h.image,width:n.width,height:n.height,url:n.url};t.addChildAtIndex(m.parse(e),0)}else if(n.fillStyle){let e=l(n);delete e.children,e.type=h.rect,e.x=0,e.y=0,t.addChildAtIndex(m.parse(e),0)}}),Promise.all(u).then(t=>{t.forEach(({url:t,bitmap:e})=>{w.set(t,e)}),y.add(v({option:o.model})),setTimeout(()=>{y.update(),i&&i()},0)})}function v({option:t,parent:e}){const n=new r.a.Group;return t.width&&(n.width=t.width),t.height&&(n.height=t.height),S(n,t,e),t.children&&t.children.forEach(t=>{let e=null,i={option:t,parent:n};switch(t.type){case h.group:e=v(i);break;case h.rect:case h.circle:e=C(i);break;case h.image:e=k(i);break;case h.text:e=P(i);break}e&&n.add(e)}),n}function C({option:t,parent:e}){const n=new f(t);return S(n,t,e),F(n,t),n}function k({option:t,parent:e}){let n=w.get(t.url);if(n){n.used?n=n.clone():n.used=!0;let i=n.width;n.scale=t.width/i,S(n,t,e),F(n,t);const r=new f({width:n.width,height:t.height?t.height/n.scale:n.height,r:t.isCircular?t.width/n.scale/2:t.r/n.scale||0,type:"rect",fillStyle:"#0000"});return n.clip(r),n}return null}function P({option:t,parent:e}){const n=new p(t);return t.shadow&&(n.shadow=t.shadow),S(n,t,e),F(n,t),n}function F(t,e,n){if(!e.rotation)return;let i,r=0;switch(e.type){case h.image:i=t.width,r=t.height,t.x+=i/2*t.scale,t.y+=r/2*t.scale;break;case h.text:i=t.getWidth(),i>e.maxWidth&&(i=e.maxWidth),r=t.getHeight(),t.x+=i/2,t.y+=r/2;break;default:i=e.width,r=e.height,t.x+=i/2,t.y+=r/2;break}t.originX=i/2,t.originY=r/2,t.rotation=e.rotation}function S(t,e,n){N({ele:t,option:e,value:"x",parent:n}),N({ele:t,option:e,value:"y",parent:n})}function N({ele:t,option:e,value:n,parent:i}){switch(e[n]){case"center":switch(e.type){case h.image:t[n]=(i.width-t.width*t.scale)/2;break;case h.text:t[n]=(i.width-t.getWidth())/2;break}break;case"bottom":switch(e.type){case h.image:t[n]=i.height-t.height*t.scale;break;case h.rect:case h.group:t[n]=i.height-e.height;break}break;default:switch(e.type){case h.circle:t[n]=e[n]+e.r;break;default:t[n]=e[n]||0;break}}}function E(t){return new Promise((e,n)=>{if(s)wx.getImageInfo({src:t,success(n){new r.a.Bitmap(n.path.startsWith("http")?n.path:t,function(){e({url:t,bitmap:this})})},fail(n){e({url:t,bitmap:null})}});else{const n=new Image;n.onload=function(){new r.a.Bitmap(t,function(){e({url:t,bitmap:this})})},n.onerror=function(n){e({url:t,bitmap:null})},n.src=t}})}function T(t){t.all().forEach(t=>{let e=t.model;if(e.type===h.text&&"auto"===e.height){let n=new p(e),i=n.getHeight()-(e.uiheight||0);t.getPath().forEach((t,e,n)=>{if(0===e)t.model.height+=i;else{let e=t.parent;e.children.slice(t.getIndex()+1,e.children.length).forEach(t=>{t.model.pin||isNaN(parseInt(t.model.y))||(t.model.y+=i)})}})}})}}])});